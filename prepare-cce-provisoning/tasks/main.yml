---

- name: Create dir first
  file: 
    path: "{{ cce_provisioning_code_path }}"
    state: directory

- name: Create dir first
  file: 
    path: "{{ cce_provisioning_content_path }}"
    state: directory

- name: Synchronize and delete code in dest
  synchronize:
    src: "{{ cce_provisioning_code_localpath }}"
    dest: "{{ cce_provisioning_code_path }}"
    delete: yes
    recursive: yes
    owner: yes
    group: yes

- name: Synchronize and delete content in dest
  synchronize:
    src: "{{ cce_provisioning_content_localpath }}"
    dest: "{{ cce_provisioning_content_path }}"
    delete: yes
    recursive: yes
    owner: yes
    group: yes

- name: Fix permission on newly synced dir
  file: 
    path: "{{ cce_provisioning_code_path }}"
    state: directory
    recurse: yes
    owner: "{{ cce_owner }}"
    group: "{{ cce_group }}"
    mode: 0775

- name: Fix permission on newly synced dir
  file: 
    path: "{{ cce_provisioning_content_path }}"
    state: directory
    recurse: yes
    owner: "{{ cce_owner }}"
    group: "{{ cce_group }}"
    mode: 0775