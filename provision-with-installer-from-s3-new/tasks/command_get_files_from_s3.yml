---

  - debug: var=webmethods_provisioning_files_download_descritors verbosity=3

  - name: Downloading all required files from S3
    include_role:
      name: aws-wrapper
    vars:
      command: "getfroms3"
      getfroms3_bucket_name: "{{ outer_item.bucket_name }}"
      getfroms3_bucket_path: "{{ outer_item.bucket_path }}"
      getfroms3_local_path: "{{ outer_item.local_path }}"
      getfroms3_force_download: "{{ outer_item.force_download | default(webmethods_s3repo_force_redownload,true) }}"
      getfroms3_local_path_owner_user: "{{ outer_item.local_path_owner_user | default(webmethods_install_localtarget_files_owner_user,true) }}"
      getfroms3_local_path_owner_group: "{{ outer_item.local_path_owner_group | default(webmethods_install_localtarget_files_owner_group,true) }}"
      getfroms3_local_path_permission: "{{ outer_item.local_path_permission | default(webmethods_install_localtarget_files_permissions,true) }}"
      getfroms3_local_path_create_dir_ifnotexist: "{{ outer_item.local_path_create_dir_ifnotexist | default(webmethods_install_localtarget_create_dir_ifnotexist,true) }}"
      getfroms3_local_path_create_dir_owner_user: "{{ outer_item.local_path_create_dir_owner_user | default(webmethods_install_localtarget_create_dir_owner_user,true) }}"
      getfroms3_local_path_create_dir_owner_group: "{{ outer_item.local_path_create_dir_owner_group | default(webmethods_install_localtarget_create_dir_owner_group,true) }}"
      getfroms3_local_path_create_dir_permission: "{{ outer_item.local_path_create_dir_permission | default(webmethods_install_localtarget_create_dir_permission,true) }}"
    when:
      - outer_item is defined
      - outer_item.bucket_name is defined and outer_item.bucket_name != ""
      - outer_item.bucket_path is defined and outer_item.bucket_path != ""
      - outer_item.local_path is defined and outer_item.local_path != ""
    with_items: "{{ webmethods_provisioning_files_download_descritors | default([],true) }}"
    loop_control:
      loop_var: outer_item