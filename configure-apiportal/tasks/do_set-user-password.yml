---


  - name: Clear the params facts
    set_fact:
      all_params: []

  - name: append api portal server
    set_fact:
      all_params: "{{ all_params }} + [ '--server' ]"
      all_params: "{{ all_params }} + [ '{{ webmethods_apiportal_tenantmgmt_server }}' ]"
    when: webmethods_apiportal_tenantmgmt_server is defined and webmethods_apiportal_tenantmgmt_server != ""

  - name: append aliases to the all_params list
    set_fact:
      all_params: "{{ all_params }} + [ 'target.nodes=[{{ all_aliases | join(',') }}]' ]"
    when: all_aliases is defined and (all_aliases|length>0)
    
  - name: run install_fixes command
    command: "/bin/bash ./y-tenantmgmt.sh --server "{{ webmethods_apiportal_tenantmgmt_server }}" --tenant "{{ webmethods_apiportal_tenantmgmt_tenant }}" changePassword -u {{ webmethods_apiportal_tenantmgmt_editor_user }} -p {{ webmethods_apiportal_tenantmgmt_editor_password }}"
    args:
      chdir: "{{ webmethods_apiportal_tools_dir }}"



./y-tenantmgmt.sh --server "localhost:18101" --tenant "default" changePassword -u system -p manager -au superuser -ap test123



  - name: Command apply ssl certs
    block:

      - name: fail if runnable_suffix not specified
        fail: 
          msg: "runnable_suffix not specified...cannot do anything."
        when: runnable_suffix is not defined or runnable_suffix == ""

      - import_role: 
          name: command-apiportal
        vars:
          webmethods_apiportal_acc_command: "stop loadbalancer_{{ runnable_suffix }}"

      - import_role: 
          name: command-apiportal
        vars:
          webmethods_apiportal_acc_command: "enhance loadbalancer_{{ runnable_suffix }} with sslCertificate local file {{ webmethods_apiportal_ssl_zip_path }}"

      - import_role: 
          name: command-apiportal
        vars:
          webmethods_apiportal_acc_command: "start loadbalancer_{{ runnable_suffix }}"
    
    when: webmethods_apiportal_ssl_zip_path is defined and webmethods_apiportal_ssl_zip_path != ""