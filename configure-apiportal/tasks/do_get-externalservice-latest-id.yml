---

  - name: set initial facts
    set_fact:
      runnable_suffix: "{{ webmethods_apiportal_acc_install_size_code }}"

  - name: fail if runnable_suffix not specified
    fail: 
      msg: "runnable_suffix not specified...cannot do anything."
    when: runnable_suffix is not defined or runnable_suffix == ""

  - name: fail if rvar_apiportal_configs_externalservice_type not specified
    fail: 
      msg: "rvar_apiportal_configs_externalservice_type not specified...cannot do anything."
    when: rvar_apiportal_configs_externalservice_type is not defined

  - import_role: 
      name: command-apiportal
    vars:
      webmethods_apiportal_acc_command_type: "command"
      webmethods_apiportal_acc_command: "list external services"

  - name: Print the cmd_result to the console.
    debug:
      msg: "{{ cmd_result.stdout }}"

  - name: Ansible grep pattern for extservice type
    shell: "grep -r 'DB\\|external' {{ cmd_result.stdout }}"
    register: grep_output
    ignore_errors: true

  - debug:
      var: grep_output.stdout_lines
    when: grep_output.stdout != "