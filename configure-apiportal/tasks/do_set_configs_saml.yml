---

## TODO configure_integrationserver_wxconfig_set_encrypted_values_changed --> because the encrypted values file gets renamed automatically, need to improve this to be able to use it

  - debug: var=rvar_apiportal_configs_saml verbosity=3

  - name: Set changed flag to false if not defined
    set_fact: 
      configure_apiportal_saml_changed: false
    when: configure_apiportal_saml_changed is not defined

  - name: Install configuration only if defined
    block:

      - name: fail if configs staging dir is not specified
        fail: 
          msg: "configs staging dir is not specified, cannot do anything."
        when: rvar_apiportal_configs_staging_dir is not defined or rvar_apiportal_configs_staging_dir == ""
        
      - name: Make sure the staging dir is there
        file:
          path: "{{ rvar_apiportal_configs_staging_dir }}"
          state: directory

      - name: Populate configuration with variables and put in staging dir
        template:
          src: apiportal_configs_saml.json.j2
          dest: "{{ rvar_apiportal_configs_staging_dir }}/umc_configs_saml.properties"
        vars:
          configs_saml: "{{ rvar_apiportal_configs_saml }}"
        register: "result_content_operation"

      - name: Execute import
        include_tasks: "do_import_umc_configs.yml"
        vars:
          rvar_apiportal_tenantmgmt_importconfig_filepath: "{{ rvar_apiportal_configs_staging_dir }}/umc_configs_saml.properties"

      - name: Set changed flag to true if any mutating operation did change
        set_fact: 
          configure_apiportal_saml_changed: true
        when: result_content_operation.changed == true

    when: rvar_apiportal_configs_saml is defined

  - name: Print the changed var
    debug:
      var: configure_apiportal_saml_changed
      verbosity: 2